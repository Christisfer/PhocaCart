function phUpdateUrlParameter(e,o,r){if(void 0!==r){var t=(s=r).split("#"),a="";1<t.length&&(a=t[1])}else{var s=window.location.href;a=location.hash}if(0<=(s=s.replace(a,"")).indexOf(e+"=")){var n=s.substring(0,s.indexOf(e)),p=s.substring(s.indexOf(e));s=n+e+"="+o+(p=0<=(p=p.substring(p.indexOf("=")+1)).indexOf("&")?p.substring(p.indexOf("&")):"")}else s.indexOf("?")<0?s+="?"+e+"="+o:s+="&"+e+"="+o;if(s=s.replace(/[^=&]+=(&|$)/g,"").replace(/&$/,""),void 0!==r)return s+a;window.history.pushState(null,null,s+a)}function phDoSubmitFormUpdateInputBox(e,o){return phRequest=jQuery.ajax({type:"POST",url:o,async:!0,cache:"false",data:e,dataType:"HTML",success:function(e){jQuery("#phPosInputBox").html(e)}}),!1}function phDoSubmitFormUpdateCategoriesBox(e,o){return"main.content.customers"!=jQuery("#phPosPaginationBox input[name=page]").val()||(phRequest=jQuery.ajax({type:"POST",url:o,async:!0,cache:"false",data:e,dataType:"HTML",success:function(e){jQuery("#phPosCategoriesBox").html(e)}})),!1}function phPosCurrentData(e,o,r){var t=Joomla.getOptions("phVarsPC").token;if(void 0!==e)var a=e;else a=jQuery("#phPosPaginationBox input[name=page]").val();if(void 0!==o)var s=o;else s="raw";if(void 0!==r)var n="&id="+r;else n="";return"format="+s+"&tmpl=component&page="+a+n+"&ticketid="+jQuery("#phPosPaginationBox input[name=ticketid]").val()+"&unitid="+jQuery("#phPosPaginationBox input[name=unitid]").val()+"&sectionid="+jQuery("#phPosPaginationBox input[name=sectionid]").val()+"&"+t+"=1"}function phPosClearFilter(){phUpdateUrlParameter("category",""),jQuery("input.phPosCategoryCheckbox:checkbox:checked").prop("checked",!1),jQuery("label.phCheckBoxCategory").removeClass("active"),phUpdateUrlParameter("search",""),jQuery("#phPosSearch").val("")}function phPosManagePageFocus(e){if(1!=Joomla.getOptions("phParamsPC").posFocusInputFields)return!0;if("main.content.products"==e)jQuery("#phPosSearch").is(":focus")||jQuery("#phPosSku").focus();else if("main.content.customers"==e){jQuery("#phPosSearch").is(":focus")||jQuery("#phPosCard").focus()}else if("main.content.paymentmethods"==e){jQuery("#phPosSearch").is(":focus")||jQuery("#phcoupon").focus()}else"main.content.payment"==e&&jQuery("#phAmountTendered").focus()}function phPosManagePage(){var e=jQuery("#phPosPaginationBox input[name=page]").val();"main.content.products"==e?(jQuery(".ph-pos-checkbox-box").show(),jQuery(".ph-pos-sku-product-box").show(),jQuery(".ph-pos-card-user-box").hide(),jQuery(".ph-pos-search-box").show(),jQuery(".ph-pos-date-order-box").hide(),phPosManagePageFocus(e)):"main.content.customers"==e?(jQuery(".ph-pos-checkbox-box").hide(),jQuery(".ph-pos-search-box").show(),jQuery(".ph-pos-card-user-box").show(),jQuery(".ph-pos-sku-product-box").hide(),jQuery(".ph-pos-date-order-box").hide(),phPosManagePageFocus(e)):"main.content.order"==e?(jQuery(".ph-pos-checkbox-box").hide(),jQuery(".ph-pos-search-box").hide(),jQuery(".ph-pos-card-user-box").hide(),jQuery(".ph-pos-sku-product-box").hide(),jQuery(".ph-pos-date-order-box").hide()):"main.content.orders"==e?(jQuery(".ph-pos-checkbox-box").hide(),jQuery(".ph-pos-search-box").hide(),jQuery(".ph-pos-card-user-box").hide(),jQuery(".ph-pos-sku-product-box").hide(),jQuery(".ph-pos-date-order-box").show()):"main.content.paymentmethods"==e||"main.content.payment"==e?(jQuery(".ph-pos-checkbox-box").hide(),jQuery(".ph-pos-search-box").hide(),jQuery(".ph-pos-card-user-box").hide(),jQuery(".ph-pos-sku-product-box").hide(),jQuery(".ph-pos-date-order-box").hide(),phPosManagePageFocus(e)):(jQuery(".ph-pos-checkbox-box").hide(),jQuery(".ph-pos-search-box").hide(),jQuery(".ph-pos-card-user-box").hide(),jQuery(".ph-pos-sku-product-box").hide(),jQuery(".ph-pos-date-order-box").hide())}function phAddSuffixToUrl(e,o){return e+(-1!=e.indexOf("?")?"&":"?")+o}function phAjaxEditPos(e,o,t,a){var s=phAddSuffixToUrl(window.location.href,"format=raw"),n=phPosCurrentData("main.input"),p=phPosCurrentData("main.categories"),i=phPosCurrentData("main.cart","json");return phRequest=jQuery.ajax({type:"POST",url:o,async:!0,cache:"false",data:e,dataType:"JSON",success:function(e){if(1==e.status){if("undefined"!==e.id)var o=e.id;else o="";var r=phPosCurrentData(t,"raw",o);phDoSubmitFormUpdateCategoriesBox(p,s),phRenderPage(r,s),phDoSubmitFormUpdateInputBox(n,s),phDoSubmitFormUpdateCart(i),jQuery(".ph-pos-message-box").html(e.message)}else if(0==e.status){r=phPosCurrentData(a);phRenderPage(r,s),phDoSubmitFormUpdateInputBox(n,s),phDoSubmitFormUpdateCart(i),jQuery(".ph-pos-message-box").html(e.error)}}}),!1}function phFindMember(e){var o="search="+e+"&"+phPosCurrentData();phUpdateUrlParameter("search",e);var r=phAddSuffixToUrl(window.location.href,"format=raw");phRenderPage(o,r),jQuery(".ph-pos-message-box").html("")}function phScrollPosCart(e){if(0<jQuery("#ph-msg-ns").length)e.animate({scrollTop:0},1500);else{var o=e[0].scrollHeight;e.animate({scrollTop:o},1500)}}function phConfirm(o,e,r){return jQuery("#phDialogConfirm .modal-body").html(r),jQuery("#phDialogConfirm").modal(),jQuery("#phDialogConfirm").modal({keyboard:!1}),jQuery("#phDialogConfirm").modal("show"),jQuery("#phDialogConfirmSave").on("click",function(e){return phPosCloseTicketFormConfirmed=!0,""!=o&&jQuery(o).submit(),!0}),!1}jQuery(document).ready(function(){phPosManagePage(),jQuery(document).on("submit","#phPosSkuProductForm",function(){setTimeout(function(){jQuery("#phPosSku").val("")},100)}),jQuery(document).on("submit","#phPosCardUserForm",function(){setTimeout(function(){jQuery("#phPosCard").val("")},100)});var e=Joomla.getOptions("phLangPC"),o=document.getElementsByTagName("script"),s=0;jQuery.each(o,function(e,o){var r=o.src,t=r.indexOf("?"),a=(r=r.substring(0,-1!=t?t:r.length)).split("\\\\").pop().split("/").pop();"bootstrap.min.js"!=a&&"bootstrap.js"!=a||s++}),1<s&&(jQuery("#phPosWarningMsgBox").text(e.COM_PHOCACART_WARNING_BOOTSTRAP_JS_LOADED_MORE_THAN_ONCE),jQuery("#phPosWarningMsgBox").show()),jQuery(document).on("click",".loadMainContent",function(e){phPosClearFilter();var o=phAddSuffixToUrl(window.location.href,"format=raw"),r=jQuery(this).closest("form").serialize();phRenderPage(r,o),jQuery(".ph-pos-message-box").html(""),e.preventDefault()}),jQuery(document).on("click",".editMainContent",function(e){phPosClearFilter();var o=phAddSuffixToUrl(window.location.href,"format=json"),r=jQuery(this).closest("form");phAjaxEditPos(r.serialize(),o,r.find('input[name="redirectsuccess"]').val(),r.find('input[name="redirecterror"]').val()),jQuery(".ph-pos-message-box").html(""),e.preventDefault()}),jQuery(document).on("submit","#phPosCardUserForm",function(e){phPosClearFilter();var o=phAddSuffixToUrl(window.location.href,"format=json");phAjaxEditPos(jQuery("#phPosCardUserForm").serialize(),o,"main.content.products","main.content.products"),jQuery(".ph-pos-message-box").html(""),e.preventDefault()}),jQuery(document).on("submit","#phPosDateOrdersForm",function(e){phPosClearFilter();var o=phAddSuffixToUrl(window.location.href,"format=raw"),r=jQuery("#phPosDateOrdersForm").serialize();phRenderPage(r,o),jQuery(".ph-pos-message-box").html(""),e.preventDefault()}),phPosCloseTicketFormConfirmed=!1,jQuery(document).on("submit","#phPosCloseTicketForm",function(e){var o=jQuery(this).data("txt");return phPosCloseTicketFormConfirmed?!(phPosCloseTicketFormConfirmed=!1):(phConfirm("#phPosCloseTicketForm","",o),e.preventDefault(),!1)}),jQuery(document).on("change","#phPosCategoriesBox .phPosCategoryCheckbox",function(){if(2==Joomla.getOptions("phParamsPC").posFilterCategory){var e=[];jQuery("input.phPosCategoryCheckbox:checkbox:checked").each(function(){e.push(jQuery(this).val())});var o=e.join(",")}else{o=jQuery(this).val();jQuery("input.phPosCategoryCheckbox:checkbox:checked").each(function(){o!=jQuery(this).val()&&(jQuery(this).prop("checked",!1),jQuery("label.phCheckBoxCategory").removeClass("active"))}),0==jQuery(this).prop("checked")&&(o="")}var r="category="+o+"&"+phPosCurrentData();phUpdateUrlParameter("category",o);var t=phAddSuffixToUrl(window.location.href,"format=raw");phRenderPage(r,t),jQuery(".ph-pos-message-box").html("")});var r=null;jQuery("#phPosSearch").keyup(function(){clearTimeout(r);var e=jQuery(this);r=setTimeout(function(){phFindMember(e.val())},800)}),jQuery("#phPosContentBox").on("click",".phOrderPrintBtn",function(e){var o=Joomla.getOptions("phVarsPC"),r=Joomla.getOptions("phParamsPC").posServerPrint,t=o.urlOrder,a=jQuery(this).data("order"),s=jQuery(this).data("type"),n=(jQuery("#phPosOrderPrintBox").attr("data-order"),jQuery("#phPosOrderPrintBox").attr("data-type"));if("-1"==s){if(2!=r&&3!=r)return window.print(),!1;if("4"!=n)return window.print(),!1;var p=phAddSuffixToUrl(t,"id="+a+"&type="+n+"&pos=1&printserver=1");return phRequestPrint=jQuery.ajax({type:"GET",url:p,async:!0,cache:"false",dataType:"HTML",success:function(e){jQuery(".ph-pos-message-box").html("<div>"+e+"</div>")}}),e.preventDefault(),!1}var i="phType"+s;t=phAddSuffixToUrl(t,"id="+a+"&type="+s+"&pos=1");phRequest=jQuery.ajax({type:"GET",url:t,async:!0,cache:"false",dataType:"HTML",success:function(e){jQuery("#phPosOrderPrintBox").attr("class",i),jQuery("#phPosOrderPrintBox").attr("data-type",s),jQuery("#phPosOrderPrintBox").html(e)}}),e.preventDefault()});var t=jQuery("#phPosCart");phScrollPosCart(t),t.on("DOMSubtreeModified",function(){""!=t.text()&&phScrollPosCart(t)})});